<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>共通テスト判定＆戦略アドバイザー</title>
    <meta name="description" content="共通テストの素点から偏差値を自動換算し、志望分野に合わせたおすすめ大学や併願校（ヘイガン港）、対策戦略を一発で判定するツールです。">
    
    <!-- OGP Tags for Social Media -->
    <meta property="og:title" content="共テ判定＆戦略アドバイザー">
    <meta property="og:description" content="共通テストの素点を入力して、おすすめ大学と戦略を即座に分析。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://github.com/"> <!-- 実際のURLに合わせて変更してください -->
    <meta property="og:image" content="https://placehold.co/600x400/2563eb/ffffff?text=Strategy+Advisor">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap');
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f0f4f8;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        main {
            flex: 1;
        }
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .gradient-text {
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .score-input {
            transition: all 0.2s;
        }
        .score-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        @media print {
            header button, footer {
                display: none;
            }
            body {
                background: white;
            }
            .card {
                box-shadow: none;
                border: 1px solid #eee;
            }
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <i class="fa-solid fa-graduation-cap text-blue-600 text-2xl"></i>
                <h1 class="text-xl font-bold text-slate-800 tracking-tight">共テ判定・戦略アドバイザー <span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full ml-1 align-middle">Open Beta</span></h1>
            </div>
            <div class="flex items-center space-x-4">
                <a href="https://github.com/" target="_blank" class="text-slate-400 hover:text-slate-800 transition text-2xl">
                    <i class="fa-brands fa-github"></i>
                </a>
                <button onclick="window.print()" class="text-slate-400 hover:text-blue-600 transition text-xl" title="結果を印刷">
                    <i class="fa-solid fa-print"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Column: Input -->
            <div class="lg:col-span-4 space-y-6">
                <!-- User Profile -->
                <div class="card p-6">
                    <h2 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fa-solid fa-user-gear mr-2 text-blue-500"></i>志望設定
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">志望分野（系統）</label>
                            <select id="fieldSelect" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-blue-500">
                                <option value="science">理系（工学・理学・農学）</option>
                                <option value="medical">理系（医学・歯学・薬学）</option>
                                <option value="humanities">文系（文学・教育・外国語）</option>
                                <option value="social">文系（法学・経済・経営）</option>
                                <option value="info">情報系（情報・データサイエンス）</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600 mb-1">第一志望大学（任意）</label>
                            <input type="text" id="targetUni" placeholder="例: 北海道大学" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-sm">
                        </div>
                    </div>
                </div>

                <!-- Score Input -->
                <div class="card p-6">
                    <h2 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fa-solid fa-pen-to-square mr-2 text-blue-500"></i>共通テスト素点入力
                    </h2>
                    <p class="text-xs text-slate-500 mb-4 bg-slate-100 p-2 rounded">
                        <i class="fa-solid fa-circle-info mr-1"></i>入力されたデータはブラウザ内でのみ処理され、外部サーバーには送信されません。
                    </p>
                    
                    <div class="space-y-3" id="scoreInputs">
                        <!-- Generated by JS -->
                    </div>

                    <button onclick="analyze()" class="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-blue-200 transition active:scale-95 flex items-center justify-center group">
                        <i class="fa-solid fa-calculator mr-2 group-hover:rotate-12 transition"></i> 判定・対策を表示
                    </button>
                </div>
            </div>

            <!-- Right Column: Results -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Summary Card -->
                <div class="card p-6 bg-gradient-to-br from-slate-800 to-slate-900 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10">
                        <i class="fa-solid fa-chart-line text-9xl"></i>
                    </div>
                    <div class="relative z-10">
                        <h3 class="text-slate-400 text-sm font-medium mb-1">総合偏差値（換算推計）</h3>
                        <div class="flex items-baseline space-x-4">
                            <span class="text-5xl font-bold tracking-tight" id="totalDev">--.-</span>
                            <span class="text-lg text-slate-400" id="totalScore">素点合計: ---/---</span>
                        </div>
                        <div class="mt-4 flex gap-2">
                            <span class="px-3 py-1 rounded-full bg-white/10 text-xs backdrop-blur-sm border border-white/10" id="dominantSubject">得意科目: ---</span>
                            <span class="px-3 py-1 rounded-full bg-red-500/20 text-red-200 text-xs backdrop-blur-sm border border-red-500/20" id="weakSubject">要対策: ---</span>
                        </div>
                    </div>
                </div>

                <!-- Analysis Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="resultSection" style="opacity: 0.5; pointer-events: none;">
                    
                    <!-- University Recommendations -->
                    <div class="card p-6 border-t-4 border-blue-500">
                        <h3 class="font-bold text-lg mb-4 flex items-center">
                            <i class="fa-solid fa-school-flag mr-2 text-blue-500"></i>おすすめ大学 & 判定
                        </h3>
                        <div class="space-y-4" id="uniRecommendations">
                            <div class="text-center text-slate-400 py-8">点数を入力して判定を開始してください</div>
                        </div>
                    </div>

                    <!-- Hagan Port (Heigan-kou) -->
                    <div class="card p-6 border-t-4 border-emerald-500">
                        <h3 class="font-bold text-lg mb-4 flex items-center">
                            <i class="fa-solid fa-anchor mr-2 text-emerald-500"></i>ヘイガン港（併願校）
                        </h3>
                        <p class="text-xs text-slate-500 mb-3">安全圏として確保すべき「港」となる大学群です。</p>
                        <div class="space-y-3" id="haganPort">
                            <div class="text-center text-slate-400 py-8">---</div>
                        </div>
                    </div>

                    <!-- Strategy -->
                    <div class="card p-6 md:col-span-2 border-t-4 border-amber-500">
                        <h3 class="font-bold text-lg mb-4 flex items-center">
                            <i class="fa-solid fa-clipboard-list mr-2 text-amber-500"></i>今後の対策戦略
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="col-span-2">
                                <div id="strategyContent" class="space-y-3 text-sm leading-relaxed text-slate-700">
                                    <!-- Strategy Text -->
                                </div>
                            </div>
                            <div class="h-48 flex items-center justify-center bg-slate-50 rounded-lg p-2">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white border-t border-slate-200 mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm text-slate-500 mb-2">
                本ツールはベータ版であり、判定結果は独自の統計データに基づいた推計値です。実際の合否を保証するものではありません。
            </p>
            <p class="text-xs text-slate-400">
                &copy; 2025 Common Test Strategy Advisor. Powered by GitHub Pages.
            </p>
        </div>
    </footer>

    <script>
        // --- 1. Data Definitions (Derived from Uploaded PDFs) ---
        // 添付ファイルのデータから主要ポイントを抽出して定義（線形補間用アンカーポイント）
        const conversionTables = {
            englishR:  { max: 100, points: [[100, 68.0], [80, 58.7], [60, 49.4], [40, 40.1], [20, 30.8], [0, 20.0]] }, // 25-statistics-10-01
            englishL:  { max: 100, points: [[100, 77.5], [80, 65.0], [60, 52.4], [40, 39.8], [20, 27.2], [0, 20.0]] }, // 25-statistics-10-01
            math1A:    { max: 100, points: [[100, 78.6], [80, 68.7], [60, 58.7], [40, 48.0], [20, 38.0], [0, 28.0]] }, // 25-statistics-10-02
            math2BC:   { max: 100, points: [[100, 68.5], [80, 59.4], [60, 50.3], [40, 41.1], [20, 32.0], [0, 22.0]] }, // 25-statistics-10-02
            japanese:  { max: 200, points: [[200, 79.9], [150, 63.2], [100, 46.6], [80, 39.9], [50, 29.9], [0, 20.0]] }, // 25-statistics-10-03
            science1:  { max: 100, points: [[100, 72.0], [80, 64.0], [60, 56.0], [40, 48.0], [20, 40.0], [0, 30.0]] }, // 仮定（ファイル不足分は一般的傾向で補完）
            science2:  { max: 100, points: [[100, 72.0], [80, 64.0], [60, 56.0], [40, 48.0], [20, 40.0], [0, 30.0]] },
            social1:   { max: 100, points: [[100, 73.8], [80, 62.9], [60, 52.1], [40, 41.2], [20, 30.0], [0, 20.0]] }, // 25-statistics-10-05 (世界史Bベース)
            info:      { max: 100, points: [[100, 81.2], [80, 67.2], [60, 53.2], [40, 39.2], [20, 25.2], [0, 15.0]] }  // 25-statistics-10-06
        };

        const subjects = [
            { id: 'englishR', name: '英語(R)', max: 100, type: 'main' },
            { id: 'englishL', name: '英語(L)', max: 100, type: 'main' },
            { id: 'math1A', name: '数学I・A', max: 100, type: 'main' },
            { id: 'math2BC', name: '数学II・B・C', max: 100, type: 'main' },
            { id: 'japanese', name: '国語', max: 200, type: 'main' },
            { id: 'science1', name: '理科①', max: 100, type: 'sub' },
            { id: 'science2', name: '理科②', max: 100, type: 'sub' },
            { id: 'social1', name: '地歴公民', max: 100, type: 'sub' },
            { id: 'info', name: '情報', max: 100, type: 'sub' }
        ];

        // 簡易大学データベース (デモ用)
        const universities = [
            { name: "北海道大学", faculty: "総合理系", dev: 62.5, field: ["science", "medical", "info"], desc: "旧帝大の雄。バランスの良い得点が必要。" },
            { name: "北海道大学", faculty: "総合文系", dev: 61.5, field: ["humanities", "social"], desc: "二次試験の配点比率に注意。" },
            { name: "東北大学", faculty: "工学部", dev: 64.0, field: ["science", "info"], desc: "理数系の高い偏差値が求められる。" },
            { name: "東京理科大学", faculty: "工学部", dev: 60.0, field: ["science", "info"], desc: "実力重視の入試。" },
            { name: "明治大学", faculty: "理工学部", dev: 58.0, field: ["science", "info"], desc: "人気私大。基礎力の完成度が鍵。" },
            { name: "明治大学", faculty: "政治経済学部", dev: 62.0, field: ["social"], desc: "私大文系のトップクラス。" },
            { name: "法政大学", faculty: "デザイン工学部", dev: 56.0, field: ["science", "info"], desc: "実践的なカリキュラムが特徴。" },
            { name: "北海学園大学", faculty: "工学部", dev: 45.0, field: ["science", "info"], desc: "道内私大の雄。併願として人気。" },
            { name: "北海学園大学", faculty: "経済学部", dev: 47.0, field: ["social"], desc: "道内での就職に強み。" },
            { name: "小樽商科大学", faculty: "商学部", dev: 53.0, field: ["social"], desc: "ビジネス実務に強い国立。" },
            { name: "室蘭工業大学", faculty: "理工学部", dev: 46.0, field: ["science", "info"], desc: "国立理系。技術者育成に定評。" }
        ];

        // --- 2. Logic Functions ---

        function init() {
            const container = document.getElementById('scoreInputs');
            subjects.forEach(sub => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between p-2 hover:bg-slate-50 rounded-lg";
                div.innerHTML = `
                    <label class="text-sm font-medium w-1/3">${sub.name}</label>
                    <div class="flex items-center w-2/3 space-x-2">
                        <input type="number" id="score_${sub.id}" max="${sub.max}" min="0" placeholder="0-${sub.max}" 
                            class="score-input w-full bg-white border border-slate-300 rounded px-3 py-1.5 text-right font-mono"
                            onchange="validateScore(this, ${sub.max})">
                        <span class="text-xs text-slate-400 w-8">/${sub.max}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function validateScore(input, max) {
            let val = parseInt(input.value);
            if (val < 0) input.value = 0;
            if (val > max) input.value = max;
        }

        // 線形補間による偏差値計算
        function calculateDeviation(subjectId, score) {
            const table = conversionTables[subjectId];
            if (!table) return 50.0; // Fallback
            
            // 範囲外処理
            if (score >= table.points[0][0]) return table.points[0][1];
            if (score <= table.points[table.points.length-1][0]) return table.points[table.points.length-1][1];

            // 該当区間を探す
            for (let i = 0; i < table.points.length - 1; i++) {
                const high = table.points[i];
                const low = table.points[i+1];
                if (score <= high[0] && score >= low[0]) {
                    // 線形補間: y = y1 + (x - x1) * (y2 - y1) / (x2 - x1)
                    const ratio = (score - low[0]) / (high[0] - low[0]);
                    return low[1] + ratio * (high[1] - low[1]);
                }
            }
            return 50.0;
        }

        function analyze() {
            // UIのアクティブ化
            document.getElementById('resultSection').style.opacity = "1";
            document.getElementById('resultSection').style.pointerEvents = "auto";

            // スコア取得と偏差値計算
            let totalScore = 0;
            let totalMaxScore = 0;
            let weightedDevSum = 0;
            let subjectCount = 0;
            let subjectDevs = {};

            subjects.forEach(sub => {
                const val = document.getElementById(`score_${sub.id}`).value;
                const score = val === "" ? 0 : parseInt(val);
                totalScore += score;
                totalMaxScore += sub.max;

                const dev = calculateDeviation(sub.id, score);
                subjectDevs[sub.id] = dev;
                
                // 単純平均用（実際は大学ごとに配点が違うが、ここでは簡易指標として）
                weightedDevSum += dev;
                subjectCount++;
            });

            const avgDev = weightedDevSum / subjectCount;
            
            // 結果表示: サマリー
            document.getElementById('totalScore').innerText = `素点合計: ${totalScore}/${totalMaxScore}`;
            document.getElementById('totalDev').innerText = avgDev.toFixed(1);

            // 得意・苦手判定
            const sortedDevs = Object.entries(subjectDevs).sort((a,b) => b[1] - a[1]);
            const bestSubId = sortedDevs[0][0];
            const worstSubId = sortedDevs[sortedDevs.length-1][0];
            
            document.getElementById('dominantSubject').innerText = `得意: ${subjects.find(s=>s.id===bestSubId).name}`;
            document.getElementById('weakSubject').innerText = `要対策: ${subjects.find(s=>s.id===worstSubId).name}`;

            renderRecommendations(avgDev, sortedDevs);
            renderRadarChart(subjectDevs);
        }

        function renderRecommendations(userDev, sortedDevs) {
            const field = document.getElementById('fieldSelect').value;
            const targetName = document.getElementById('targetUni').value;
            
            const recContainer = document.getElementById('uniRecommendations');
            const haganContainer = document.getElementById('haganPort');
            recContainer.innerHTML = "";
            haganContainer.innerHTML = "";

            // フィルタリング
            let relevantUnis = universities.filter(u => u.field.includes(field));
            
            // ユーザー指定大学があれば強制追加（データベースになくてもダミーで表示するロジックを組むべきだが、今回はDB内検索）
            if(targetName) {
                // 部分一致検索
                const customMatch = universities.find(u => u.name.includes(targetName));
                if(customMatch && !relevantUnis.includes(customMatch)) {
                    relevantUnis.unshift(customMatch);
                }
            }

            // 判定ロジック
            let hasSafety = false;

            relevantUnis.forEach(uni => {
                const diff = userDev - uni.dev;
                let judgment = "";
                let colorClass = "";
                let icon = "";
                
                if (diff >= 5) {
                    judgment = "A判定 (安全圏)";
                    colorClass = "text-emerald-600 bg-emerald-50 border-emerald-200";
                    icon = "fa-solid fa-circle-check";
                    
                    // ヘイガン港に追加
                    haganContainer.innerHTML += createUniCard(uni, judgment, "安全な港です。ここを確保して攻めましょう。", "border-emerald-500");
                    hasSafety = true;

                } else if (diff >= 2) {
                    judgment = "B判定 (有力圏)";
                    colorClass = "text-blue-600 bg-blue-50 border-blue-200";
                    icon = "fa-solid fa-thumbs-up";
                    recContainer.innerHTML += createUniCard(uni, judgment, uni.desc, "border-blue-500");

                } else if (diff >= -2) {
                    judgment = "C判定 (合格圏)";
                    colorClass = "text-amber-600 bg-amber-50 border-amber-200";
                    icon = "fa-solid fa-scale-balanced";
                    recContainer.innerHTML += createUniCard(uni, judgment, `あなたの実力に見合っています。${uni.desc}`, "border-amber-500");

                } else if (diff >= -5) {
                    judgment = "D判定 (挑戦圏)";
                    colorClass = "text-orange-600 bg-orange-50 border-orange-200";
                    icon = "fa-solid fa-fire";
                    recContainer.innerHTML += createUniCard(uni, judgment, "あと一歩です。苦手科目の克服で届きます。", "border-orange-500");

                } else {
                    judgment = "E判定 (再考圏)";
                    colorClass = "text-red-600 bg-red-50 border-red-200";
                    icon = "fa-solid fa-triangle-exclamation";
                    recContainer.innerHTML += createUniCard(uni, judgment, "高い壁ですが、戦略次第。基礎の見直しを。", "border-red-500");
                }
            });

            if (!hasSafety) {
                haganContainer.innerHTML = `<div class="p-3 text-sm text-red-500 bg-red-50 rounded border border-red-200">
                    <i class="fa-solid fa-triangle-exclamation mr-1"></i>
                    現在のスコアに基づく安全な「ヘイガン港」が見つかりませんでした。志望ランクを下げるか、地方国立・独自日程の私大を検討してください。
                </div>`;
            }

            // 戦略アドバイス生成
            const weakSubObj = subjects.find(s => s.id === sortedDevs[sortedDevs.length-1][0]);
            const strongSubObj = subjects.find(s => s.id === sortedDevs[0][0]);
            
            let strategyHTML = `
                <p><strong class="text-blue-600">${strongSubObj.name}</strong>があなたの武器です。これを維持しつつ、足を引っ張っている<strong class="text-red-600">${weakSubObj.name}</strong>の基礎固めを優先しましょう。</p>
                <p class="mt-2">特に共通テストは「広く浅く」が基本ですが、${weakSubObj.name}の偏差値${sortedDevs[sortedDevs.length-1][1].toFixed(1)}は、基礎問題での取りこぼしがあることを示唆しています。</p>
            `;
            
            // 科目別ミニコメント
            if (sortedDevs[sortedDevs.length-1][1] < 45) {
                strategyHTML += `<p class="mt-2 text-amber-700 bg-amber-50 p-2 rounded text-xs">
                    <i class="fa-solid fa-lightbulb mr-1"></i>
                    <strong>${weakSubObj.name}緊急対策:</strong> 応用問題は捨てて、教科書の例題レベルと過去問の大問1〜2だけを完璧にする「守りの受験」に切り替えましょう。
                </p>`;
            }

            if (userDev >= 60 && userDev < 65) {
                 strategyHTML += `<p class="mt-2 text-blue-700 bg-blue-50 p-2 rounded text-xs">
                    <i class="fa-solid fa-arrow-trend-up mr-1"></i>
                    <strong>旧帝大・難関大を目指す場合:</strong> 7割〜8割の壁を超えるには、苦手科目を「平均」にするより、得意科目を「満点近く」にする方が早い場合があります。${strongSubObj.name}で満点を狙う演習を追加してください。
                </p>`;
            }

            document.getElementById('strategyContent').innerHTML = strategyHTML;
        }

        function createUniCard(uni, judgment, reason, borderColor) {
            return `
                <div class="flex items-start p-3 bg-white border-l-4 ${borderColor} shadow-sm rounded-r mb-3">
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <h4 class="font-bold text-slate-700">${uni.name} <span class="text-xs font-normal text-slate-500">${uni.faculty}</span></h4>
                            <span class="text-xs font-bold px-2 py-0.5 rounded ${judgment.includes('A') || judgment.includes('B') ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'}">${judgment}</span>
                        </div>
                        <p class="text-xs text-slate-500">${reason}</p>
                    </div>
                </div>
            `;
        }

        let chartInstance = null;
        function renderRadarChart(subjectDevs) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            // データ整形
            const labels = subjects.map(s => s.name);
            const data = subjects.map(s => subjectDevs[s.id]);

            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '科目別偏差値',
                        data: data,
                        fill: true,
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgb(59, 130, 246)',
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(59, 130, 246)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            angleLines: { color: '#e2e8f0' },
                            grid: { color: '#e2e8f0' },
                            pointLabels: { font: { size: 10, family: "'Noto Sans JP', sans-serif" } },
                            suggestedMin: 30,
                            suggestedMax: 80
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    },
                    maintainAspectRatio: false
                }
            });
        }

        // Initialize
        init();

    </script>
</body>
</html>
