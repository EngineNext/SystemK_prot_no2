<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>共通テスト判定＆戦略アドバイザー v2.0</title>
    <meta name="description" content="文系・理系別の科目入力に対応。共通テストの素点から偏差値を自動換算し、最適な入試方式（前期・後期・共テ利用）を推奨するツール。">
    
    <!-- OGP Tags -->
    <meta property="og:title" content="共テ判定＆戦略アドバイザー v2">
    <meta property="og:description" content="文理別の入力フォームと入試方式レコメンド機能を搭載。">
    <meta property="og:type" content="website">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap');
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f0f4f8;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        main {
            flex: 1;
        }
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
        }
        .score-input {
            transition: all 0.2s;
        }
        .score-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        /* 入力フォーム切り替えアニメーション */
        .input-group {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media print {
            header button, footer, .no-print {
                display: none;
            }
            body {
                background: white;
            }
            .card {
                box-shadow: none;
                border: 1px solid #eee;
                break-inside: avoid;
            }
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <i class="fa-solid fa-graduation-cap text-indigo-600 text-2xl"></i>
                <h1 class="text-xl font-bold text-slate-800 tracking-tight">共テ判定・戦略アドバイザー <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-0.5 rounded-full ml-1 align-middle">v2.0</span></h1>
            </div>
            <div class="flex items-center space-x-4">
                <button onclick="window.print()" class="text-slate-400 hover:text-indigo-600 transition text-xl" title="結果を印刷">
                    <i class="fa-solid fa-print"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Column: Settings & Input -->
            <div class="lg:col-span-4 space-y-6">
                <!-- User Profile -->
                <div class="card p-6 border-t-4 border-indigo-500">
                    <h2 class="text-lg font-bold mb-4 flex items-center text-slate-700">
                        <i class="fa-solid fa-sliders mr-2 text-indigo-500"></i>志望設定
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-1">志望分野（文理選択）</label>
                            <p class="text-xs text-slate-500 mb-2">選択に応じて入力科目が変化します</p>
                            <select id="fieldSelect" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm focus:ring-2 focus:ring-indigo-500 transition" onchange="updateFormUI()">
                                <optgroup label="理系">
                                    <option value="science" selected>理系（工・理・農）</option>
                                    <option value="medical">理系（医・歯・薬）</option>
                                    <option value="info_sci">情報系（理系）</option>
                                </optgroup>
                                <optgroup label="文系">
                                    <option value="humanities">文系（文・教育・外国語）</option>
                                    <option value="social">文系（法・経済・経営）</option>
                                    <option value="info_arts">情報系（文系）</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-1">第一志望大学（任意）</label>
                            <input type="text" id="targetUni" placeholder="例: 北海道大学" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-sm">
                        </div>
                    </div>
                </div>

                <!-- Score Input -->
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold flex items-center text-slate-700">
                            <i class="fa-solid fa-pencil mr-2 text-indigo-500"></i>素点入力
                        </h2>
                        <span id="subjectCountBadge" class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">理系型: 8科目</span>
                    </div>
                    
                    <div class="space-y-3" id="scoreInputs">
                        <!-- Javascriptで動的に生成されます -->
                    </div>

                    <button onclick="analyze()" class="w-full mt-6 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-indigo-200 transition active:scale-95 flex items-center justify-center group">
                        <i class="fa-solid fa-wand-magic-sparkles mr-2 group-hover:rotate-12 transition"></i> 判定・推奨方式を表示
                    </button>
                </div>
            </div>

            <!-- Right Column: Results -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Summary Card -->
                <div class="card p-6 bg-slate-800 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10">
                        <i class="fa-solid fa-chart-pie text-9xl"></i>
                    </div>
                    <div class="relative z-10 flex flex-col md:flex-row md:items-end justify-between gap-4">
                        <div>
                            <h3 class="text-slate-400 text-sm font-medium mb-1">総合偏差値（換算推計）</h3>
                            <div class="flex items-baseline space-x-3">
                                <span class="text-5xl font-bold tracking-tight" id="totalDev">--.-</span>
                                <span class="text-sm text-slate-400 bg-slate-700 px-2 py-1 rounded" id="totalScore">素点: ---</span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <div class="text-right">
                                <div class="text-xs text-slate-400 mb-1">得意科目</div>
                                <span class="px-3 py-1 rounded bg-indigo-500 text-white text-sm font-bold" id="dominantSubject">---</span>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-slate-400 mb-1">対策優先</div>
                                <span class="px-3 py-1 rounded bg-rose-500 text-white text-sm font-bold" id="weakSubject">---</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analysis Results -->
                <div id="resultSection" class="space-y-6 opacity-50 pointer-events-none transition-opacity duration-500">
                    
                    <!-- University Recommendations with Methods -->
                    <div class="card p-6 border-t-4 border-indigo-500">
                        <h3 class="font-bold text-lg mb-4 flex items-center text-slate-800">
                            <i class="fa-solid fa-bullseye mr-2 text-indigo-500"></i>大学別・推奨入試方式判定
                        </h3>
                        <p class="text-sm text-slate-500 mb-4">あなたの得点特性に基づき、最も合格可能性が高い方式を提案します。</p>
                        <div class="space-y-4" id="uniRecommendations">
                            <div class="text-center text-slate-400 py-12 bg-slate-50 rounded-lg border border-dashed border-slate-200">
                                左側のフォームに点数を入力して判定を開始してください
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Hagan Port -->
                        <div class="card p-6 border-t-4 border-emerald-500 h-full">
                            <h3 class="font-bold text-lg mb-4 flex items-center text-slate-800">
                                <i class="fa-solid fa-anchor mr-2 text-emerald-500"></i>ヘイガン港（併願推奨）
                            </h3>
                            <div class="space-y-3" id="haganPort">
                                <div class="text-center text-slate-400 py-8">---</div>
                            </div>
                        </div>

                        <!-- Chart -->
                        <div class="card p-6 border-t-4 border-amber-500 h-full flex flex-col">
                            <h3 class="font-bold text-lg mb-2 flex items-center text-slate-800">
                                <i class="fa-solid fa-chart-radar mr-2 text-amber-500"></i>科目バランス
                            </h3>
                            <div class="flex-1 flex items-center justify-center min-h-[200px]">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Strategy Text -->
                    <div class="card p-6 bg-gradient-to-r from-indigo-50 to-white border border-indigo-100">
                        <h3 class="font-bold text-lg mb-3 flex items-center text-indigo-800">
                            <i class="fa-solid fa-clipboard-check mr-2"></i>戦略アドバイス
                        </h3>
                        <div id="strategyContent" class="text-sm leading-relaxed text-slate-700 space-y-2">
                            ---
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <footer class="bg-slate-50 border-t border-slate-200 mt-12 py-8 no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-xs text-slate-500">
            <p class="mb-2">本ツールはアップロードされた統計データに基づくシミュレーションです。実際の合否や入試区分の詳細は各大学の募集要項をご確認ください。</p>
            <p>&copy; 2025 Common Test Strategy Advisor v2.0</p>
        </div>
    </footer>

    <script>
        // --- 1. Data Definitions ---
        
        // 換算テーブル (アップロードされたPDFデータの傾向値を採用)
        const conversionTables = {
            englishR:  { max: 100, points: [[100, 68.0], [80, 58.7], [60, 49.4], [40, 40.1], [20, 30.8], [0, 20.0]] },
            englishL:  { max: 100, points: [[100, 77.5], [80, 65.0], [60, 52.4], [40, 39.8], [20, 27.2], [0, 20.0]] },
            math1A:    { max: 100, points: [[100, 78.6], [80, 68.7], [60, 58.7], [40, 48.0], [20, 38.0], [0, 28.0]] },
            math2BC:   { max: 100, points: [[100, 68.5], [80, 59.4], [60, 50.3], [40, 41.1], [20, 32.0], [0, 22.0]] },
            japanese:  { max: 200, points: [[200, 79.9], [150, 63.2], [100, 46.6], [80, 39.9], [50, 29.9], [0, 20.0]] },
            science:   { max: 100, points: [[100, 72.0], [80, 64.0], [60, 56.0], [40, 48.0], [20, 40.0], [0, 30.0]] },
            social:    { max: 100, points: [[100, 73.8], [80, 62.9], [60, 52.1], [40, 41.2], [20, 30.0], [0, 20.0]] },
            info:      { max: 100, points: [[100, 81.2], [80, 67.2], [60, 53.2], [40, 39.2], [20, 25.2], [0, 15.0]] }
        };

        // 科目定義マスタ
        const subjectMaster = {
            englishR: { name: '英語(R)', max: 100, table: 'englishR' },
            englishL: { name: '英語(L)', max: 100, table: 'englishL' },
            math1A:   { name: '数学I・A', max: 100, table: 'math1A' },
            math2BC:  { name: '数学II・B・C', max: 100, table: 'math2BC' },
            japanese: { name: '国語', max: 200, table: 'japanese' },
            info:     { name: '情報', max: 100, table: 'info' },
            // 理系用
            science1: { name: '理科① (物理/化学等)', max: 100, table: 'science' },
            science2: { name: '理科② (物理/化学等)', max: 100, table: 'science' },
            social:   { name: '地歴公民 (1科目)', max: 100, table: 'social' },
            // 文系用
            social1:  { name: '地歴公民①', max: 100, table: 'social' },
            social2:  { name: '地歴公民②', max: 100, table: 'social' },
            scienceBasic: { name: '理科基礎 (2科目分)', max: 100, table: 'science' }
        };

        // 大学・入試方式データベース
        // exams: 方式ごとのボーダー偏差値と説明
        const universities = [
            { 
                name: "北海道大学", faculty: "総合理系", field: ["science", "medical", "info_sci"], 
                exams: [
                    { type: "前期", border: 62.5, desc: "標準的な国公立型。総合力が問われる。" },
                    { type: "後期", border: 66.0, desc: "募集人数が少なく高難易度。理科の配点が高い。" }
                ]
            },
            { 
                name: "北海道大学", faculty: "総合文系", field: ["humanities", "social", "info_arts"], 
                exams: [
                    { type: "前期", border: 61.5, desc: "共通テストの配点比率が高い。ここでの貯金が鍵。" },
                    { type: "後期", border: 65.0, desc: "小論文重視だが、共テのボーダーも跳ね上がる。" }
                ]
            },
            { 
                name: "東北大学", faculty: "工学部", field: ["science", "info_sci"], 
                exams: [
                    { type: "前期", border: 64.0, desc: "数学・理科の比重が大きい。" },
                    { type: "AO入試", border: 60.0, desc: "共テの基準点さえ超えれば面接・書類勝負。" }
                ]
            },
            { 
                name: "明治大学", faculty: "理工学部", field: ["science", "info_sci"], 
                exams: [
                    { type: "一般", border: 58.0, desc: "3教科入試。数学の難易度が高い。" },
                    { type: "共テ利用(3教科)", border: 63.0, desc: "国立併願組が多くボーダーは高騰する。" },
                    { type: "共テ利用(4教科)", border: 60.0, desc: "科目数が増える分、少しボーダーが下がる穴場。" }
                ]
            },
            { 
                name: "明治大学", faculty: "政治経済学部", field: ["social", "info_arts"], 
                exams: [
                    { type: "一般", border: 62.0, desc: "私大文系の最難関。英語勝負。" },
                    { type: "共テ利用(3教科)", border: 66.0, desc: "早慶併願レベルの得点率が必要。" },
                    { type: "共テ利用(5科目)", border: 61.0, desc: "国公立志望者向け。多科目受験ならチャンスあり。" }
                ]
            },
            { 
                name: "北海学園大学", faculty: "工学部", field: ["science", "info_sci"], 
                exams: [
                    { type: "共テ利用I期", border: 45.0, desc: "道内私大の定番。まずはここで合格確保を。" },
                    { type: "一般", border: 42.0, desc: "標準的な問題。基礎があれば解ける。" }
                ]
            },
            { 
                name: "北海学園大学", faculty: "経済学部", field: ["social", "info_arts"], 
                exams: [
                    { type: "共テ利用I期", border: 47.0, desc: "英語・国語＋1科目で判定。" },
                    { type: "一般", border: 44.0, desc: "過去問対策がそのまま得点に直結する。" }
                ]
            },
            { 
                name: "小樽商科大学", faculty: "商学部", field: ["social", "info_arts"], 
                exams: [
                    { type: "前期", border: 53.0, desc: "英語の配点が高い。英語が得意なら有利。" },
                    { type: "後期", border: 56.0, desc: "道内・道外から志願者が集まる。" }
                ]
            },
            { 
                name: "室蘭工業大学", faculty: "理工学部", field: ["science", "info_sci"], 
                exams: [
                    { type: "前期", border: 46.0, desc: "数学・理科が得意なら逆転しやすい配点。" },
                    { type: "後期", border: 50.0, desc: "前期で決めたい。" }
                ]
            }
        ];

        // --- 2. Logic Functions ---

        // 現在のモード（文系/理系）に基づいて入力フォームを生成
        let currentSubjectKeys = [];

        function updateFormUI() {
            const field = document.getElementById('fieldSelect').value;
            const container = document.getElementById('scoreInputs');
            const badge = document.getElementById('subjectCountBadge');
            
            container.innerHTML = '';
            
            // 文系・理系の科目構成定義
            // 文系: 地歴公民2つ、理科基礎1つ (国立型想定)
            // 理系: 理科2つ、地歴公民1つ
            let subjects = [];
            
            // 共通科目
            const common = ['englishR', 'englishL', 'math1A', 'math2BC', 'japanese', 'info'];

            if (['humanities', 'social', 'info_arts'].includes(field)) {
                // 文系パターン
                subjects = [...common, 'social1', 'social2', 'scienceBasic'];
                badge.innerText = "文系型: 5教科8科目相当";
                badge.className = "text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded";
            } else {
                // 理系パターン
                subjects = [...common, 'science1', 'science2', 'social'];
                badge.innerText = "理系型: 5教科7科目";
                badge.className = "text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded";
            }

            currentSubjectKeys = subjects;

            // フォーム生成
            subjects.forEach((key, index) => {
                const sub = subjectMaster[key];
                const div = document.createElement('div');
                div.className = "input-group flex items-center justify-between p-2 hover:bg-slate-50 rounded-lg border-b border-transparent hover:border-slate-100";
                div.style.animationDelay = `${index * 0.03}s`;
                div.innerHTML = `
                    <label class="text-sm font-medium w-1/2 text-slate-700">${sub.name}</label>
                    <div class="flex items-center w-1/2 space-x-2">
                        <input type="number" id="score_${key}" max="${sub.max}" min="0" placeholder="-" 
                            class="score-input w-full bg-white border border-slate-300 rounded px-3 py-2 text-right font-mono text-slate-700"
                            onchange="validateScore(this, ${sub.max})">
                        <span class="text-xs text-slate-400 w-8">/${sub.max}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function validateScore(input, max) {
            let val = parseInt(input.value);
            if (val < 0) input.value = 0;
            if (val > max) input.value = max;
        }

        function calculateDeviation(tableKey, score) {
            const table = conversionTables[tableKey];
            if (!table) return 50.0;
            
            if (score >= table.points[0][0]) return table.points[0][1];
            if (score <= table.points[table.points.length-1][0]) return table.points[table.points.length-1][1];

            for (let i = 0; i < table.points.length - 1; i++) {
                const high = table.points[i];
                const low = table.points[i+1];
                if (score <= high[0] && score >= low[0]) {
                    const ratio = (score - low[0]) / (high[0] - low[0]);
                    return low[1] + ratio * (high[1] - low[1]);
                }
            }
            return 50.0;
        }

        function analyze() {
            // UI表示
            const resultSection = document.getElementById('resultSection');
            resultSection.style.opacity = "1";
            resultSection.style.pointerEvents = "auto";

            // 計算
            let totalScore = 0;
            let totalDevSum = 0;
            let count = 0;
            let subjectDevs = {}; // チャート用
            
            // 科目ごとの偏差値を計算
            currentSubjectKeys.forEach(key => {
                const input = document.getElementById(`score_${key}`);
                const score = input.value === "" ? 0 : parseInt(input.value);
                const subConfig = subjectMaster[key];
                
                totalScore += score;
                const dev = calculateDeviation(subConfig.table, score);
                
                totalDevSum += dev;
                count++;

                // チャート用データ（キーを日本語名に変換）
                subjectDevs[subConfig.name] = dev;
            });

            const avgDev = totalDevSum / count;

            // 表示更新
            document.getElementById('totalScore').innerText = `素点合計: ${totalScore}`;
            document.getElementById('totalDev').innerText = avgDev.toFixed(1);

            // 得意・苦手
            const sorted = Object.entries(subjectDevs).sort((a,b) => b[1] - a[1]);
            document.getElementById('dominantSubject').innerText = sorted[0][0];
            document.getElementById('weakSubject').innerText = sorted[sorted.length-1][0];

            // 判定 & チャート
            renderRecommendations(avgDev);
            renderRadarChart(subjectDevs);
        }

        function renderRecommendations(userDev) {
            const field = document.getElementById('fieldSelect').value;
            const targetName = document.getElementById('targetUni').value;
            const recContainer = document.getElementById('uniRecommendations');
            const haganContainer = document.getElementById('haganPort');
            
            recContainer.innerHTML = "";
            haganContainer.innerHTML = "";

            // フィルタリング
            let relevantUnis = universities.filter(u => u.field.includes(field));
            
            // ターゲット指定があれば追加
            if(targetName) {
                const customMatches = universities.filter(u => u.name.includes(targetName));
                // 重複排除して追加
                customMatches.forEach(cm => {
                    if (!relevantUnis.includes(cm)) relevantUnis.unshift(cm);
                });
            }

            let hasSafety = false;

            relevantUnis.forEach(uni => {
                // 各大学の中で、最も推奨される方式（判定が良いもの）を探す
                let bestExam = null;
                let bestDiff = -999;
                let bestJudgment = "";
                let bestColor = "";

                // その大学の全ての入試方式をチェック
                uni.exams.forEach(exam => {
                    const diff = userDev - exam.border;
                    if (diff > bestDiff) {
                        bestDiff = diff;
                        bestExam = exam;
                    }
                });

                // 判定ロジック
                if (bestDiff >= 5) {
                    bestJudgment = "A判定";
                    bestColor = "bg-emerald-100 text-emerald-800 border-emerald-200";
                    // 安全校はヘイガン港へ
                    haganContainer.innerHTML += createUniCard(uni, bestExam, bestJudgment, bestColor, true);
                    hasSafety = true;
                } else if (bestDiff >= 2) {
                    bestJudgment = "B判定";
                    bestColor = "bg-indigo-100 text-indigo-800 border-indigo-200";
                    recContainer.innerHTML += createUniCard(uni, bestExam, bestJudgment, bestColor, false);
                } else if (bestDiff >= -2) {
                    bestJudgment = "C判定";
                    bestColor = "bg-amber-100 text-amber-800 border-amber-200";
                    recContainer.innerHTML += createUniCard(uni, bestExam, bestJudgment, bestColor, false);
                } else if (bestDiff >= -5) {
                    bestJudgment = "D判定";
                    bestColor = "bg-orange-100 text-orange-800 border-orange-200";
                    recContainer.innerHTML += createUniCard(uni, bestExam, bestJudgment, bestColor, false);
                } else {
                    bestJudgment = "E判定";
                    bestColor = "bg-rose-100 text-rose-800 border-rose-200";
                    recContainer.innerHTML += createUniCard(uni, bestExam, bestJudgment, bestColor, false);
                }
            });

            if (!hasSafety) {
                haganContainer.innerHTML = `<div class="text-sm text-rose-500 bg-rose-50 p-3 rounded border border-rose-100">
                    <i class="fa-solid fa-triangle-exclamation mr-1"></i>
                    現在のスコアでは安全圏の大学がデータ内に見つかりません。志望ランクの見直しや、独自日程の私大併願を検討してください。
                </div>`;
            }

            // 戦略テキスト生成
            let strategyHTML = "";
            const weakSubName = document.getElementById('weakSubject').innerText;
            
            if (userDev >= 60) {
                strategyHTML += `<p><strong><span class="text-indigo-600">攻めの受験</span>が可能です。</strong> 全体的に高水準ですが、${weakSubName}での失点が上位校合格のボトルネックになり得ます。ここを「平均点」まで引き上げるだけで、A判定の大学がグッと増えるでしょう。</p>`;
                strategyHTML += `<p class="mt-2 text-xs text-slate-500">※推奨方式に「共テ利用」が出ている場合、私大を共通テストだけで確保し、国立の2次対策に全リソースを集中するのが賢明です。</p>`;
            } else {
                strategyHTML += `<p><strong><span class="text-amber-600">守りと攻めのバランス</span>が必要です。</strong> ${weakSubName}は基礎問題（大問1,2）だけを確実に取り、得意科目でカバーする戦略を立てましょう。</p>`;
                strategyHTML += `<p class="mt-2 text-xs text-slate-500">※E判定の大学でも、方式によってはD〜Cに近づくものがあるかもしれません。傾斜配点（特定科目の配点が高い方式）を要項で確認してください。</p>`;
            }
            document.getElementById('strategyContent').innerHTML = strategyHTML;
        }

        function createUniCard(uni, exam, judgment, colorClass, isHagan) {
            // 推奨バッジ: 判定が良い方式を目立たせる
            const recommendBadge = `<span class="text-[10px] font-bold uppercase tracking-wider text-slate-400 border border-slate-200 px-1.5 py-0.5 rounded ml-2">推奨方式</span>`;
            
            return `
                <div class="flex flex-col p-4 bg-white border border-slate-100 shadow-sm rounded-lg hover:shadow-md transition">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-bold text-slate-800 text-md">${uni.name}</h4>
                            <div class="text-xs text-slate-500">${uni.faculty}</div>
                        </div>
                        <span class="px-2 py-1 rounded text-xs font-bold ${colorClass}">${judgment}</span>
                    </div>
                    <div class="mt-1 pt-2 border-t border-slate-50">
                        <div class="flex items-center mb-1">
                            <span class="font-bold text-indigo-600 text-sm mr-2">${exam.type}</span>
                            ${recommendBadge}
                        </div>
                        <p class="text-xs text-slate-600 leading-snug">${exam.desc}</p>
                    </div>
                </div>
            `;
        }

        let chartInstance = null;
        function renderRadarChart(dataObj) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            const labels = Object.keys(dataObj);
            const data = Object.values(dataObj);

            if (chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '偏差値',
                        data: data,
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: '#6366f1',
                        pointBackgroundColor: '#6366f1',
                        pointBorderColor: '#fff',
                        borderWidth: 2,
                    }]
                },
                options: {
                    scales: {
                        r: {
                            angleLines: { color: '#e2e8f0' },
                            grid: { color: '#e2e8f0' },
                            pointLabels: { 
                                font: { size: 10, family: "'Noto Sans JP', sans-serif" },
                                color: '#64748b'
                            },
                            suggestedMin: 30,
                            suggestedMax: 75,
                            ticks: { display: false }
                        }
                    },
                    plugins: { legend: { display: false } },
                    maintainAspectRatio: false
                }
            });
        }

        // 初期化
        updateFormUI();
        
    </script>
</body>
</html>
